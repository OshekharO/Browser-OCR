<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>tesseract | OCR</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
  </head>
  <body>
  <div class="min-vh-100 bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark navbar-gradient shadow-sm">
      <div class="container d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center gap-2">
          <div class="brand-mark rounded-circle d-flex align-items-center justify-content-center">
            <span class="fw-semibold">OCR</span>
          </div>
          <div>
            <div class="navbar-brand fw-semibold mb-0">Image Translation</div>
            <div class="navbar-text small text-white-50">Client-side image to text with Tesseract.js</div>
          </div>
        </div>
        <span class="badge rounded-pill bg-light text-primary-emphasis fw-semibold">No uploads · Browser-only</span>
      </div>
    </nav>

    <header class="hero">
      <div class="container d-flex flex-wrap gap-4 align-items-center justify-content-between">
        <div class="text-white">
          <p class="text-uppercase small text-white-50 mb-1">Bootstrap + Tesseract.js</p>
          <h1 class="display-6 mb-2">Extract text from images instantly</h1>
          <p class="lead text-white-50 mb-3">Batch multiple images, pick a language, and keep everything on-device for privacy.</p>
          <div class="d-flex flex-wrap gap-2">
            <span class="badge bg-light text-primary-emphasis">Multi-language</span>
            <span class="badge bg-light text-primary-emphasis">Batch processing</span>
            <span class="badge bg-light text-primary-emphasis">Copy &amp; download</span>
          </div>
        </div>
        <div class="hero-card bg-white bg-opacity-25 text-white border border-white border-opacity-25 rounded-4 p-3">
          <div class="d-flex flex-column gap-2">
            <div class="d-flex align-items-center justify-content-between">
              <span class="small text-white-50">OCR status</span>
              <span class="badge bg-success-subtle text-success-emphasis">Client</span>
            </div>
            <div class="fw-semibold">Tesseract.js 4.x</div>
            <p class="small mb-0 text-white-50">Uses WASM core and language packs loaded from Project Naptha.</p>
          </div>
        </div>
      </div>
    </header>

    <main class="container py-5">
      <div class="row g-4">
        <div class="col-lg-6">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h1 class="h4 mb-3">Upload images</h1>
              <p class="text-muted small mb-4">Supported formats: PNG, JPG, JPEG, GIF, BMP, TIFF. Processing happens in your browser—no files are uploaded to the server.</p>
              <div class="mb-3">
                <label for="imageInput" class="form-label fw-semibold">Choose images</label>
                <input class="form-control" type="file" id="imageInput" accept="image/*" multiple>
              </div>
              <div class="mb-3">
                <label for="languageSelect" class="form-label fw-semibold">Language</label>
                <select class="form-select" id="languageSelect">
                  <option value="eng" selected>English (eng)</option>
                  <option value="spa">Spanish (spa)</option>
                  <option value="fra">French (fra)</option>
                  <option value="deu">German (deu)</option>
                  <option value="ita">Italian (ita)</option>
                  <option value="por">Portuguese (por)</option>
                  <option value="hin">Hindi (hin)</option>
                  <option value="chi_sim">Chinese Simplified (chi_sim)</option>
                </select>
                <div class="form-text">Select the OCR language. Multiple images are supported.</div>
              </div>
              <div id="previewArea" class="border border-dashed rounded p-3 text-center bg-white">
                <p class="text-muted mb-2" id="placeholderText">No images selected yet.</p>
                <div id="previewList" class="d-flex flex-wrap gap-2 justify-content-center"></div>
              </div>
              <div class="d-flex flex-wrap gap-2 mt-4">
                <button id="extractBtn" class="btn btn-primary" disabled>
                  <span class="spinner-border spinner-border-sm me-2 d-none" id="loadingSpinner" role="status" aria-hidden="true"></span>
                  Extract Text
                </button>
                <button id="clearBtn" class="btn btn-outline-secondary">Clear</button>
              </div>
              <div class="progress mt-3 d-none" id="progressWrapper" style="height: 8px;">
                <div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar" role="progressbar" style="width: 0%;"></div>
              </div>
              <div class="text-muted small mt-2" id="statusText"></div>
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column">
              <div class="d-flex align-items-center mb-3">
                <h2 class="h4 mb-0">Extracted text</h2>
                <span class="badge bg-info-subtle text-info-emphasis ms-2">Tesseract.js</span>
              </div>
              <textarea id="resultText" class="form-control flex-grow-1 mb-3" rows="10" readonly placeholder="Your extracted text will appear here"></textarea>
              <div class="d-flex flex-wrap gap-2">
                <button id="copyBtn" class="btn btn-outline-primary" disabled>Copy</button>
                <button id="downloadBtn" class="btn btn-outline-success" disabled>Download</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer py-4 text-center">
      <div class="container d-flex flex-column gap-2 align-items-center">
        <div class="fw-semibold text-muted">Image Translation · Client-side OCR</div>
        <div class="text-muted small">Powered by Bootstrap &amp; Tesseract.js</div>
        <div class="d-flex flex-wrap justify-content-center gap-3 small">
          <a class="link-secondary text-decoration-none" href="https://github.com/OshekharO/image-translation" target="_blank" rel="noreferrer">GitHub</a>
          <a class="link-secondary text-decoration-none" href="README.md">Docs</a>
          <a class="link-secondary text-decoration-none" href="CONTRIBUTING.md">Contribute</a>
        </div>
      </div>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
  <script src="assets/tesseract/tesseract.min.js"></script>
  <script>
    const imageInput = document.getElementById('imageInput');
    const previewList = document.getElementById('previewList');
    const placeholderText = document.getElementById('placeholderText');
    const extractBtn = document.getElementById('extractBtn');
    const clearBtn = document.getElementById('clearBtn');
    const progressWrapper = document.getElementById('progressWrapper');
    const progressBar = document.getElementById('progressBar');
    const statusText = document.getElementById('statusText');
    const resultText = document.getElementById('resultText');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const languageSelect = document.getElementById('languageSelect');
    const workerPath = 'assets/tesseract/worker.min.js';
    const corePath = 'assets/tesseract/tesseract-core.wasm.js';
    const langPath = 'https://tessdata.projectnaptha.com/4.0.0';
    const resultSeparator = '\n\n---\n\n';
    const ocrOptions = {
      preserve_interword_spaces: 1, // keep spacing close to the original layout
      tessedit_pageseg_mode: 3, // fully automatic page segmentation
      user_defined_dpi: 300, // hint DPI to improve recognition fidelity
    };

    function resetUI() {
      imageInput.value = '';
      previewList.innerHTML = '';
      placeholderText.classList.remove('d-none');
      extractBtn.disabled = true;
      progressWrapper.classList.add('d-none');
      progressBar.style.width = '0%';
      statusText.textContent = '';
      resultText.value = '';
      copyBtn.disabled = true;
      downloadBtn.disabled = true;
      loadingSpinner.classList.add('d-none');
    }

    function updateButtonsState() {
      const hasResult = resultText.value.trim().length > 0;
      copyBtn.disabled = !hasResult;
      downloadBtn.disabled = !hasResult;
    }

    function safeFileName(name) {
      if (!name) return 'image';
      const cleaned = String(name).replace(/[^a-zA-Z0-9_. -]/g, ' ').replace(/\s+/g, ' ').trim();
      return cleaned || 'image';
    }

    function showPreviews(files) {
      previewList.innerHTML = '';
      if (!files.length) {
        placeholderText.classList.remove('d-none');
        return;
      }
      placeholderText.classList.add('d-none');

      files.forEach((file) => {
        const safeName = safeFileName(file.name);
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.alt = safeName;
          img.className = 'img-fluid rounded shadow-sm preview-thumb';
          previewList.appendChild(img);
        };
        reader.onerror = () => {
          statusText.textContent = `Unable to read "${safeName}". Please try a different image.`;
        };
        reader.readAsDataURL(file);
      });
    }

    function updateProgress(currentIndex, totalFiles, message) {
      if (!totalFiles) return;
      if (!message || !message.status) return;
      if (message.status === 'recognizing text' && typeof message.progress === 'number') {
        const base = (currentIndex / totalFiles) * 100;
        const overall = Math.min(100, Math.round(base + (message.progress * (100 / totalFiles))));
        progressBar.style.width = `${overall}%`;
        statusText.textContent = `Processing ${currentIndex + 1}/${totalFiles}... ${Math.round(message.progress * 100)}%`;
      } else {
        statusText.textContent = `${message.status} (${currentIndex + 1}/${totalFiles})`;
      }
    }

    imageInput.addEventListener('change', (event) => {
      const files = Array.from(event.target.files || []);
      if (!files.length) {
        resetUI();
        return;
      }
      showPreviews(files);
      extractBtn.disabled = false;
      statusText.textContent = '';
    });

    extractBtn.addEventListener('click', async () => {
      const files = Array.from(imageInput.files || []);
      if (!files.length) {
        statusText.textContent = 'Please select at least one image first.';
        return;
      }

      extractBtn.disabled = true;
      loadingSpinner.classList.remove('d-none');
      progressWrapper.classList.remove('d-none');
      progressBar.style.width = '0%';
      statusText.textContent = 'Initializing...';

      try {
        const language = languageSelect.value || 'eng';
        const totalFiles = files.length;
        let combinedText = '';

        for (let i = 0; i < totalFiles; i++) {
          const file = files[i];
          const { data: { text } } = await Tesseract.recognize(file, language, {
            workerPath,
            corePath,
            langPath,
            ...ocrOptions,
            logger: (m) => updateProgress(i, totalFiles, m)
          });

          const cleanedText = text.trim();
          if (cleanedText) {
            const segment = totalFiles > 1
              ? `File: ${safeFileName(file.name)}\n${cleanedText}`
              : cleanedText;
            combinedText += combinedText ? `${resultSeparator}${segment}` : segment;
          }

          progressBar.style.width = `${Math.round(((i + 1) / totalFiles) * 100)}%`;
        }

        resultText.value = combinedText;
        statusText.textContent = combinedText ? 'Done!' : 'No text detected.';
        updateButtonsState();
      } catch (error) {
        console.error(error);
        const rawMessage = error && error.message ? String(error.message).replace(/[\r\n]+/g, ' ').trim() : '';
        const hint = rawMessage ? `: ${rawMessage}` : '';
        statusText.textContent = `There was a problem reading the image(s)${hint}. Please ensure the files are supported and try again.`;
      } finally {
        extractBtn.disabled = false;
        loadingSpinner.classList.add('d-none');
        progressWrapper.classList.add('d-none');
        progressBar.style.width = '0%';
      }
    });

    clearBtn.addEventListener('click', resetUI);

    copyBtn.addEventListener('click', async () => {
      if (!navigator.clipboard) {
        statusText.textContent = 'Clipboard not available. Please copy the text manually.';
        return;
      }
      try {
        await navigator.clipboard.writeText(resultText.value);
        statusText.textContent = 'Copied to clipboard.';
      } catch (err) {
        statusText.textContent = 'Unable to copy. Please copy manually.';
      }
    });

    downloadBtn.addEventListener('click', () => {
      const blob = new Blob([resultText.value], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'ocr-result.txt';
      document.body.appendChild(link);
      link.click();
      link.remove();
      URL.revokeObjectURL(url);
      statusText.textContent = 'Download started.';
    });

    resetUI();
  </script>
</body>
</html>
